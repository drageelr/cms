<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>CMS Deployer</title>
  <meta name="description" content="Deployer for CCA Management System">
  <meta name="author" content="Hammad Nasir">
</head>
<body>
<h1>CMS Deployer</h1>
<hr />
<h2>Server Instance Status</h2>
<button onclick="refreshStatus()">Refresh</button>
<h3>Branch: </h3>
<div id="branch-div">None</div> <br />
<h3>Database: </h3>
<div id="db-div">None</div> <br />
<h3>Status: </h3>
<div id="status-div">None</div> <br />
<h3>Server Status: </h3>
<div id="server-status-div">None</div> <br />
<hr />
<h2>Deploy New Server Instance</h2>
<h3>Branch:</h3>
<select id="branch-select" name="branch-name">
  <option selected="selected" value="master">Master</option>
  <option value="server-master">Server Master</option>
  <option value="server-wip-hn">Server WIP Hammad Nasir</option>
  <option value="server-wip-ha">Server WIP Hamza Aqeel</option>
  <option value="client-master">Client Master</option>
  <option value="client-wip-zq">Client WIP Zoraiz Qureshi</option>
  <option value="client-wip-fr">Client WIP Farrukh Rasool</option>
  <option value="client-wip-hf">Client WIP Hamza Farooq</option>
</select><br />
<h3>Database:</h3>
<select id="db-select" name="db-name">
  <option selected="selected" value="prod">Production</option>
  <option value="dev-hn">Hammad Nasir DB</option>
  <option value="dev-ha">Hamza Aqeel DB</option>
  <option value="dev-zq">Zoraiz Qureshi DB</option>
  <option value="dev-fr">Farrukh Rasool DB</option>
  <option value="dev-hf">Hamza Farooq DB</option>
</select>
<br/>
<br/>
<button id="startServerButton" onclick="startServer()">Start Server </button>
<br/>
<button id="stopServerButton" onclick="stopServer()">Stop Server</button>

<script>
    async function startServer() {
      document.getElementById("startServerButton").disabled = true
      setTimeout(() => {
        document.getElementById("startServerButton").disabled = false
      }, 30000)

      const selectedBranch = document.getElementById("branch-select").value
      const selectedDB = document.getElementById("db-select").value
      const res = await fetch('http://167.71.224.73/dev/api/start', {
        method: 'POST',
        body:{
          branchName: selectedBranch,
          dbName: selectedDB
        }
      })


      const data = await res.json()
      const {statusCode, statusName, message} = data
      console.log(data)
    }

    async function stopServer() {
      const res = await fetch('http://167.71.224.73/dev/api/stop', {
        method: 'GET',
      })

      const data = await res.json()
      const {statusCode, statusName, message} = data
          
      console.log(data)
    }
    
    async function refreshStatus() {
      const res = await fetch('http://167.71.224.73/dev/api/status', {method: 'GET'})
      const data = await res.json()
      console.log(data)
      
      const {statusCode, statusName,  branchName, dbName, serverStatus} = data

      document.getElementById("branch-div").innerHTML = branchName
      document.getElementById("db-div").innerHTML = dbName
      document.getElementById("status-div").innerHTML = `Status Code: ${statusCode}<br /> Status Name: ${statusName}`
      document.getElementById("server-status-div").innerHTML = serverStatus.replace(/\n/g, "<br />")
    }

  </script>
</body>
</form>